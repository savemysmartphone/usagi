#!/usr/bin/env ruby
require 'rspec'
require 'usagi'

Usagi.start

ENV['RAILS_ENV']  = 'test'

begin
  Usagi.rspec = RSpec::Core::Runner.run((ARGV + Dir['./spec/usagi/**/*.rb']).flatten)
rescue
  puts "[usagi][#{Usagi.pid}] RSpec encountered an exception"
  Usagi.stop
  raise
end

Usagi.stop
Process.exit(Usagi.rspec) if Usagi.rspec != 0
